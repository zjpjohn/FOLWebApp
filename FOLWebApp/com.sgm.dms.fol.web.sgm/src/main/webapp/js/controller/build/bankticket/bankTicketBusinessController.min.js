/*! web.sgm 2016-09-28 */
FolController.controller("BankTicketCollectController",["$scope","$timeout","$q","$state","BankTicketDeatilService","BankInfoService","CodeService",function(a,b,c,d,e,f,g){a.istableshow=!1,b(function(){if($("#datagrid").length>0){var c=$("#datagrid").datagrid("getPager");c.pagination({onSelectPage:function(b,c){a.query_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.query_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.query_data,"bankTicket/collect/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}})}$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),f.findAll("bankTicket/bankInfo/findAll",function(a,c){if($.messager.progress("close"),!folUtil.isNull(a)){var d=[];d.push({bankAbbr:"-1",bankChName:"请选择"}),$.each(a.rows,function(a,b){d.push(b)}),console.log(a),console.log(d),b(function(){$("#bankId").combobox("loadData",d),$("#bankId").combobox("select",d[0].bankAbbr)})}},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))}),$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT});var d=["渠道类型"];g.findCodeTypeNames(d,"code/findCodeTypeNames",function(a){$.messager.progress("close");var c=["#dealerType"];b(function(){for(var b=0;b<a.length;b++)folUtil.isNull(a[b])||($(c[b]).combobox("loadData",a[b]),$(c[b]).combobox("select",a[b][0].code))})},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}),a.query=function(){a.istableshow=!0,a.query_data={dealerType:folUtil.getComboBoxDataById("dealerType"),bankId:folUtil.getComboBoxDataById("bankId"),beginNo:0,endNo:10},$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.query_data,"bankTicket/collect/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}}]),FolController.controller("BankTicketDeatilController",["$scope","$timeout","$q","$state","BankTicketDeatilService","BankInfoService","CodeService",function(a,b,c,d,e,f,g){a.istableshow=!1,b(function(){if($("#datagrid").length>0){var c=$("#datagrid").datagrid("getPager");c.pagination({onSelectPage:function(b,c){a.query_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.query_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.query_data,"bankTicket/deatil/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}})}$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),f.findAll("bankTicket/bankInfo/findAll",function(a,c){if($.messager.progress("close"),!folUtil.isNull(a)){var d=[];d.push({bankAbbr:"-1",bankChName:"请选择"}),$.each(a.rows,function(a,b){d.push(b)}),b(function(){$("#bankId").combobox("loadData",d),$("#bankId").combobox("select",d[0].bankAbbr)})}},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))});var d=[];d.push({value:"-1",displayName:"请选择"}),d.push({value:"0",displayName:"银票已到期"}),d.push({value:"1",displayName:"银票未到期"}),d.push({value:"2",displayName:"银票已背书"}),d.push({value:"3",displayName:"银票已贴现"}),b(function(){$("#bankTicketStatus").combobox("loadData",d),$("#bankTicketStatus").combobox("select",d[0].value)});var h=["渠道类型","品牌"];g.findCodeTypeNames(h,"code/findCodeTypeNames",function(a){$.messager.progress("close");var c=["#dealerType","#brandId"];b(function(){for(var b=0;b<a.length;b++)folUtil.isNull(a[b])||($(c[b]).combobox("loadData",a[b]),$(c[b]).combobox("select",a[b][0].code))})},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}),a.query=function(){a.istableshow=!0,a.query_data={dealerType:folUtil.getComboBoxDataById("dealerType"),brandId:folUtil.getComboBoxDataById("brandId"),bankId:folUtil.getComboBoxDataById("bankId"),sapCode:$("#sapCode").textbox("getValue"),dealerName:$("#dealerName").textbox("getValue"),documentNumber:$("#documentNumber").textbox("getValue"),acceptanceNumber:$("#acceptanceNumber").textbox("getValue"),issueDate:$("#issueDate").datebox("getValue"),expirationDate:$("#expirationDate").datebox("getValue"),bankTicketStatus:folUtil.getComboBoxDataById("bankTicketStatus"),beginNo:0,endNo:10},$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.query_data,"bankTicket/deatil/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}}]),FolController.controller("BankTicketInterestController",["$scope","$timeout","$q","$state","BankTicketInterestService","BankInfoService",function(a,b,c,d,e,f){function g(){b(function(){if($("#datagrid").length>0){var b=$("#datagrid").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.query_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.query_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.query_data,"bankTicket/bankTicketInterest/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)})}})}},PROGRESS_ACTION_TIMEOUT)}function h(){return $("#startIssueDate").datebox("getValue")>$("#endIssueDate").datebox("getValue")?($.messager.alert("提示","起始开票日期不能大于结束开票日期"),!1):!0}a.istableshow=!1,b(function(){$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),f.findAll("bankTicket/bankInfo/findAll",function(a,c){if($.messager.progress("close"),!folUtil.isNull(a)){var d=[];d.push({bankAbbr:"-1",bankChName:"请选择"}),$.each(a.rows,function(a,b){d.push(b)}),b(function(){$("#bankId").combobox("loadData",d),$("#bankId").combobox("select",d[0].bankAbbr)})}},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))});var a=[];a.push({value:"-1",displayName:"请选择"}),a.push({value:"0",displayName:"无"}),a.push({value:"1",displayName:"有"}),b(function(){$("#documentNumberExists").combobox("loadData",a),$("#documentNumberExists").combobox("select",a[0].value)})}),a.query=function(){g(),a.istableshow=!0,a.query_data={sapCode:$("#sapCode").textbox("getValue"),bankId:folUtil.getComboBoxDataById("bankId"),acceptanceNumber:$("#acceptanceNumber").textbox("getValue"),documentNumberExists:folUtil.getComboBoxDataById("documentNumberExists"),startIssueDate:$("#startIssueDate").datebox("getValue"),endIssueDate:$("#endIssueDate").datebox("getValue"),beginNo:0,endNo:10},h()&&($.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.query_data,"bankTicket/bankTicketInterest/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)}))}}]),FolController.controller("BankTicketInterestDeatilCtrl",["$scope","$rootScope","$timeout","$q","$state","BankTicketInterestDeatilService",function(a,b,c,d,e,f){a.istableshow=!1,c(function(){if($("#interestDatagrid").length>0){var b=$("#interestDatagrid").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.query_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.query_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),f.query(a.query_data,"bankTicket/interestDeatil/query",function(a,b){$.messager.progress("close"),$("#interestDatagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}})}}),a.query=function(){$("#interestDataTable").attr("class","row-fluid ng-show"),a.istableshow=!0,a.query_data={acceptanceNumber:$("#acceptanceNumber").textbox("getValue"),documentNumber:$("#documentNumber").textbox("getValue"),startIssueDate:$("#startIssueDate").datebox("getValue"),endIssueDate:$("#endIssueDate").datebox("getValue"),startExpirationDate:$("#startExpirationDate").datebox("getValue"),endExpirationDate:$("#endExpirationDate").datebox("getValue"),sapCode:b.bankticket_interest_deatil_data.sapCode,year:b.bankticket_interest_deatil_data.year,month:b.bankticket_interest_deatil_data.month,beginNo:0,endNo:10},$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),f.query(a.query_data,"bankTicket/interestDeatil/query",function(a,b){$.messager.progress("close"),$("#interestDatagrid").datagrid("loadData",{total:0,rows:[]}),$("#interestDatagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}}]),FolController.controller("BankTicketInterestInventoryController",["$scope","$rootScope","$timeout","$q","$state","$window","BankTicketInterestInventoryService",function(a,b,c,d,e,f,g){a.istableshow=!1,c(function(){if(folUtil.setComboBoxYearDataById("year"),folUtil.setComboBoxMonthDataById("month"),$("#datagrid").length>0){var b=$("#datagrid").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.query_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.query_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),g.query(a.query_data,"bankTicket/businessInquiries/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}}),$("#interestDeatilWindow").panel({onBeforeOpen:function(){$("#interestDataTable").attr("class","row-fluid ng-hide")}})}}),a.query=function(){a.istableshow=!0,a.query_data={year:folUtil.getComboBoxDataById("year"),month:folUtil.convertMonthToTwoPoint(folUtil.getComboBoxDataById("month")),sapCode:$("#sapCode").textbox("getValue"),beginNo:0,endNo:10},$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),g.query(a.query_data,"bankTicket/businessInquiries/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},a.exportFile=function(){return folUtil.isNull(a.query_data)?void $.messager.alert("提示","请先查询一次再进行操作"):($.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),void g.getToken("services/tokens",function(b){$.messager.progress("close");var c="bankTicket/businessInquiries/exportInterestAmount?year="+a.query_data.year+"&month="+a.query_data.month+"&token="+b.token;console.log(c),f.open(c)},function(a){$.messager.progress("close"),console.log(a)}))},a.importFile=function(){e.go("uploadFilePage",{pageName:"bankTicketInterest"})},a.BankTicketInterestInventoryUpload=function(){var a=$("#datagrid").datagrid("getSelections");a.length<=0?$.messager.alert("提示","选择一条记录，再操作"):a.length>1?$.messager.alert("提示","只能一条记录，再操作"):g.InterestInventoryUpload(a[0],"bankTicket/businessInquiries/sendInterestAmount",function(a,b){console.log("suceess")},function(a){console.log("fail")})},a.issue=function(){var b=$("#datagrid").datagrid("getChecked");if(b.length<=0)return void $.messager.alert("提示","选择一条记录，再操作");for(var c="",d=0;d<b.length;d++){if(b[d].issueStatus==STATE.SUCCESS_BANK_TICKET_ISSUE)return void $.messager.alert("提示","你选择的第"+(d+1)+"行记录已发布过不能再次发布");c+=b[d].id+","}g.issue({ids:c},"bankTicket/businessInquiries/issue",function(b){$.messager.alert("提示","发布成功"),g.query(a.query_data,"bankTicket/businessInquiries/query",function(a,b){$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},function(a){$.messager.alert("提示","发布失败")})},a.bankTicketInterestDeatil=function(){var a=$("#datagrid").datagrid("getChecked");return a.length<=0?void $.messager.alert("提示","选择一条记录，再操作"):a.length>1?void $.messager.alert("提示","只能一条记录，再操作"):(a[0].year=folUtil.getComboBoxDataById("year"),a[0].month=folUtil.getComboBoxDataById("month"),b.bankticket_interest_deatil_data=a[0],void $("#interestDeatilWindow").window("open"))}}]),FolController.controller("BankTicketExceptionInventoryController",["$scope","$timeout","$window","BankTicketExceptionInventoryService",function(a,b,c,d){a.istableshow=!1,b(function(){if($("#datagrid").length>0){var b=$("#datagrid").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.query_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.query_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.query(a.query_data,"bankticket/exception/inventory",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}})}}),a.query=function(){a.istableshow=!0,a.query_data={sapCode:$("#sapCode").textbox("getValue"),acceptanceNumber:$("#acceptanceNumber").textbox("getValue"),beginNo:0,endNo:10},$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.query(a.query_data,"bankticket/exception/inventory",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{rows:[],total:0}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},a.exportFile=function(){return folUtil.isNull(a.query_data)?void $.messager.alert("提示","请先查询一次再导出"):($.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),void d.getToken("services/tokens",function(b){$.messager.progress("close"),c.open("bankticket/exception/exportQueryResult?sapCode="+a.query_data.sapCode+"&acceptanceNumber="+a.query_data.acceptanceNumber+"&token="+b.token)},function(a){$.messager.progress("close"),console.log(a)}))}}]);