/*! web.sgm 2016-09-28 */
FolController.controller("ChaimInvoiceStatusController",["$scope","$rootScope","$q","$timeout","ChaimInvoiceStatusService","CodeService","$window",function(a,b,c,d,e,f,g){function h(){var b=$("#datagrid").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.bill_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.bill_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.bill_data,"invoice/statusQuery/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)})}})}a.istableshow=!1,a.flag=!0,d(function(){var a=["SGM受理状态"];f.findCodeTypeNames(a,"code/findCodeTypeNames",function(a){$.messager.progress("close");for(var b=["#status"],c=0;c<a.length;c++)folUtil.isNull(a[c])||($(b[c]).combobox("loadData",a[c]),$(b[c]).combobox("select",a[c][0].code))},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}),a.query=function(){a.bill_data={sapCode:$("#sapCode").textbox("getValue"),invoiceNo:$("#invoiceNo").textbox("getValue"),expressNo:$("#expressNo").textbox("getValue"),status:folUtil.getComboBoxDataById("status"),approveMan:$("#approveMan").textbox("getValue"),beginNo:0,endNo:10},a.istableshow=!0,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.bill_data,"invoice/statusQuery/query",function(b,c){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",b),a.flag&&($("#datagrid").datagrid().datagrid("enableCellEditing"),h()),a.flag=!1},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)})},a.anew=function(){var b=$("#datagrid").datagrid("getChecked");if(b.length<=0)return void $.messager.alert("提示","请选择至少一条记录，再进行操作");var c="";for(var d in b)if(c.length>0&&(c+=","),c=c+b[d].invoiceNo+b[d].sapCode,5!=b[d].status)return void $.messager.alert("提示","当前状态不是SAP处理失败状态，不能给予重处理操作！");$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.anew({invoiceNo:c},"invoice/statusQuery/rehandle",function(b,c){$.messager.alert("提示","重处理操作成功"),$.messager.progress("close"),e.anew(a.bill_data,"invoice/statusQuery/query",function(a,b){$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)})},function(a){return $.messager.progress("close"),a.state===STATE.TIMEOUT?(console.log("timeout"),void $.messager.alert("提示","系统超时请稍后访问")):($.messager.alert("提示","重处理操作失败"),void console.log("error:"+a))})},a.save=function(){a.endEditing("datagrid");var b=$("#datagrid").datagrid("getChecked");if(b.length<=0)return void $.messager.alert("提示","请选择至少一条记录，再进行操作");var c=[];$.each(b,function(a,b){c.push({invoiceNo:b.invoiceNo,sapCode:b.sapCode,remark:b.remark})}),$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.checkdata(c,"invoice/statusQuery/saveRemark/getSign",function(b,c){e.save(b.rows,"invoice/statusQuery/saveRemark",function(b,c){$.messager.alert("提示","保存成功"),$.messager.progress("close"),e.query(a.bill_data,"invoice/statusQuery/query",function(a,b){$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)})},function(a){return $.messager.progress("close"),a.state===STATE.TIMEOUT?(console.log("timeout"),void $.messager.alert("提示","系统超时请稍后访问")):($.messager.alert("提示","保存失败"),void console.log("error:"+a))})},function(a){a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},a.back=function(){var b=$("#datagrid").datagrid("getChecked");if(b.length<=0)return void $.messager.alert("提示","请选择至少一条记录，再进行操作");for(var c in b)if(4==b[c].status)return void $.messager.alert("提示","当前状态是SAP处理成功状态，不能给予退回操作！");var d="";$.each(b,function(a,b){d.length>0&&(d+=","),d=d+b.invoiceNo+"||"+b.sapCode}),$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.back({invoiceNo:d},"invoice/statusQuery/sendBack",function(b,c){$.messager.alert("提示","退回操作成功"),e.query(a.bill_data,"invoice/statusQuery/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)})},function(a){return $.messager.progress("close"),a.state===STATE.TIMEOUT?(console.log("timeout"),void $.messager.alert("提示","系统超时请稍后访问")):($.messager.alert("提示","退回操作失败"),void console.log("error:"+a))})},a.deatil=function(){var a=$("#datagrid").datagrid("getSelections");return a.length<=0?void $.messager.alert("提示","选择一条记录，再操作"):a.length>1?void $.messager.alert("提示","只能一条记录，再操作"):(b.claimStatus={},b.claimStatus.sapCode=a[0].sapCode,b.claimStatus.invoiceNo=a[0].invoiceNo,b.claimStatus.expressNo=a[0].expressNo,e.queryDeatil(b.claimStatus,"invoice/statusQuery/detail",function(a,b){$("#deatildatagrid").datagrid("loadData",{total:0,rows:[]}),$("#deatildatagrid").datagrid("loadData",a)},function(a){a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)}),void $("#DeatilWindow").window("open"))},a.endEditing=function(a){var b=$("#"+a).datagrid("getRows");$.each(b,function(a,b){$("#datagrid").datagrid("validateRow",a)&&$("#datagrid").datagrid("endEdit",a)})}}]),FolController.controller("DeatilController",["$scope","$rootScope","$state","$timeout","$window","ChaimInvoiceStatusService",function(a,b,c,d,e,f){d(function(){if($("#deatildatagrid").length>0){var b=$("#deatildatagrid").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.bill_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.bill_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),f.query(a.bill_data,"invoice/statusQuery/query",function(a,b){$.messager.progress("close"),$("#deatildatagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)})}})}}),a.exit=function(){$("#DeatilWindow").window("close"),a.bill_data={expressNo:$("#sapCode").textbox("getValue"),invoiceNo:$("#invoiceNo").textbox("getValue"),expressNo:$("#expressNo").textbox("getValue"),status:folUtil.getComboBoxDataById("status"),expressNo:$("#approveMan").textbox("getValue"),beginNo:0,endNo:10},a.istableshow=!0,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),f.query(a.bill_data,"invoice/statusQuery/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#deatildatagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)})}}]),FolController.controller("ExpressScanInvoiceController",["$scope","$rootScope","$q","$timeout","ExpressScanInvoiceService","$window",function(a,b,c,d,e,f){function g(){var b=$("#datagrid").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.bill_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.bill_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.bill_data,"invoice/expressNoScanInvoice/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)})}})}a.istableshow=!1,a.query=function(){a.bill_data={invoiceNo:$("#invoiceNo").textbox("getValue"),expressNo:$("#expressNo").textbox("getValue"),sapCode:$("#sapCode").textbox("getValue"),beginNo:0,endNo:10},a.istableshow=!0,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.bill_data,"invoice/expressNoScanInvoice/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a),g()},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)})},a.agree=function(){var b=$("#datagrid").datagrid("getChecked");return b.length<=0?void $.messager.alert("提示","请选择至少一条记录，再进行操作"):2!=b[0].status?void $.messager.alert("提示","当前状态已处理,不能给予操作"):($.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),void e.agree(b,"invoice/expressNoScanInvoice/auditSuccess",function(b,c){$.messager.alert("提示","同意操作成功"),e.query(a.bill_data,"invoice/expressNoScanInvoice/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},function(a){return $.messager.progress("close"),a.state===STATE.TIMEOUT?(console.log("timeout"),void $.messager.alert("提示","系统超时请稍后访问")):($.messager.alert("提示","同意操作失败"),void console.log("error:"+a))}))},a.back=function(){var b=$("#datagrid").datagrid("getChecked");return b.length<=0?void $.messager.alert("提示","请选择至少一条记录，再进行操作"):2!=b[0].status?void $.messager.alert("提示","当前状态已处理,不能给予操作"):($.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),void e.back(b,"invoice/expressNoScanInvoice/reject",function(b,c){$.messager.alert("提示","退回操作成功"),e.query(a.bill_data,"invoice/expressNoScanInvoice/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)})},function(a){return $.messager.progress("close"),a.state===STATE.TIMEOUT?(console.log("timeout"),void $.messager.alert("提示","系统超时请稍后访问")):($.messager.alert("提示","退回操作失败"),void console.log("error:"+a))}))}}]),FolController.controller("FinancialCertificateController",["$scope","$rootScope","$q","$timeout","FinancialCertificateService","$window",function(a,b,c,d,e,f){a.istableshow=!1,d(function(){var b=$("#datagrid").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.bill_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.bill_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.bill_data,"financial/certificate/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)})}})}),a.query=function(){return a.bill_data={sapCode:$("#sapCode").textbox("getValue"),approveMan:$("#approveMan").textbox("getValue"),startTime:$("#startTime").datebox("getValue"),endTime:$("#endTime").datebox("getValue"),beginNo:0,endNo:10},null!=$("#startTime").datebox("getValue")&&null!=$("#endTime").datebox("getValue")&&""!=$("#startTime").datebox("getValue")&&""!=$("#endTime").datebox("getValue")&&$("#startTime").datebox("getValue")>$("#endTime").datebox("getValue")?void $.messager.alert("提示","开始时间不能大于结束时间"):(a.istableshow=!0,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),void e.query(a.bill_data,"financial/certificate/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)}))},a.exportCertificate=function(){e.getToken("services/tokens",function(b){return folUtil.isNull(a.bill_data)?void $.messager.alert("提示","请先查询一次再导出"):($.messager.progress("close"),void f.open("financial/certificate/invoiceDeatilExp?sapCode="+a.bill_data.sapCode+"&approveMan="+encodeURI(encodeURI(a.bill_data.approveMan))+"&startTime="+a.bill_data.startTime+"&endTime="+a.bill_data.endTime+"&token="+b.token))},function(a){$.messager.progress("close"),console.log(a)})}}]),FolController.controller("InterfaceStatusController",["$scope","$rootScope","$q","$timeout","InterfaceStatusService","CodeService","$window",function(a,b,c,d,e,f,g){a.istableshow=!1,d(function(){var b=$("#datagrid").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.bill_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.bill_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.bill_data,"interface/status/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)})}});var c=["SGM受理状态"];f.findCodeTypeNames(c,"code/findCodeTypeNames",function(a){$.messager.progress("close");var b=["#process_status"];d(function(){for(var c=0;c<a.length;c++)folUtil.isNull(a[c])||($(b[c]).combobox("loadData",a[c]),$(b[c]).combobox("select",a[c][0].code))})},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}),a.query=function(){return a.bill_data={invoiceNo:$("#invoiceNo").textbox("getValue"),process_status:folUtil.getComboBoxDataById("process_status"),startTime:$("#startTime").datebox("getValue"),endTime:$("#endTime").datebox("getValue"),beginNo:0,endNo:10},null!=$("#startTime").datebox("getValue")&&null!=$("#endTime").datebox("getValue")&&""!=$("#startTime").datebox("getValue")&&""!=$("#endTime").datebox("getValue")&&$("#startTime").datebox("getValue")>$("#endTime").datebox("getValue")?void $.messager.alert("提示","开始时间不能大于结束时间"):(a.istableshow=!0,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),void e.query(a.bill_data,"interface/status/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)}))}}]),FolController.controller("OvertimeInvoiceController",["$scope","$rootScope","$q","$timeout","OvertimeInvoiceService","$window",function(a,b,c,d,e,f){a.istableshow=!1,d(function(){var b=$("#datagrid").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.bill_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.bill_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.bill_data,"overtime/invoice/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+data)})}})}),a.query=function(){a.bill_data={sapCode:$("#sapCode").textbox("getValue"),invoiceNo:$("#invoiceNo").textbox("getValue"),expressNo:$("#expressNo").textbox("getValue"),startTime:$("#startTime").textbox("getValue"),endTime:$("#endTime").textbox("getValue"),beginNo:0,endNo:10},a.istableshow=!0,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.bill_data,"overtime/invoice/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问")),console.log("error:"+a)})}}]);