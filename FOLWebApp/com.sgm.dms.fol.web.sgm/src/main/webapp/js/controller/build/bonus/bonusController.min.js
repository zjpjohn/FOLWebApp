/*! web.sgm 2016-09-28 */
FolController.controller("bonusAmountReconcileCtrl",["$scope","$rootScope","$timeout","BonusService","$window",function(a,b,c,d,e){function f(){c(function(){if($("#datagrid").length>0){var b=$("#datagrid").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.bonus_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.bonus_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.findBonusAmount(a.bonus_data,"bonus/bonusAmountReconcile/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}})}},PROGRESS_ACTION_TIMEOUT)}a.istableshow=!1,c(function(){d.findCodeTypeNames("bonus/bonusAmountReconcile/findCodeTypeNames",function(a,d){$.messager.progress("close");var e=["#dealerType"];c(function(){$("#bonusType").combobox("loadData",b.bonusType),$("#bonusType").combobox("select",b.bonusType[0].code),folUtil.setComboBoxYearDataById("year"),folUtil.setComboBoxMonthDataById("month"),folUtil.setComboBoxYesAndNoById("isDiff");for(var c=0;c<a.length;c++)folUtil.isNull(a[c])||($(e[c]).combobox("loadData",a[c]),$(e[c]).combobox("select",a[c][0].code))})},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}),a.findbonusAmountReconcile=function(){f();var b=folUtil.getComboBoxDataById("year")+"-"+folUtil.convertMonthToTwoPoint(folUtil.getComboBoxDataById("month"));a.bonus_data={dealerType:folUtil.getComboBoxDataById("dealerType"),bonusType:folUtil.getComboBoxDataById("bonusType"),changeTime:b,isDiff:folUtil.getComboBoxDataById("isDiff"),endSapCode:$("#endSapCode").textbox("getValue"),startSapCode:$("#startSapCode").textbox("getValue"),year:folUtil.getComboBoxDataById("year"),month:folUtil.convertMonthToTwoPoint(folUtil.getComboBoxDataById("month")),beginNo:0,endNo:10},a.istableshow=!0,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.findbonusAmountReconcile(a.bonus_data,"bonus/bonusAmountReconcile/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},a.bonusAmountReconcile=function(){d.getToken("services/tokens",function(b,c){return folUtil.isNull(a.bonus_data)?void $.messager.alert("提示","请先查询一次再导出"):($.messager.progress("close"),void e.open("bonus/bonusAmountReconcile/amountReconcile?bonusType="+a.bonus_data.bonusType+"&isDiff="+a.bonus_data.isDiff+"&endSapCode="+a.bonus_data.endSapCode+"&startSapCode="+a.bonus_data.startSapCode+"&changeTime="+a.bonus_data.changeTime+"&year="+a.bonus_data.year+"&month="+a.bonus_data.month+"&dealerType="+a.bonus_data.dealerType+"&token="+b.token))},function(a){console.log(a)})}}]),FolController.controller("bonusMonthDeatilCtrl",["$scope","$rootScope","$timeout","BonusService","$window",function(a,b,c,d,e){a.istableshow=!1,c(function(){var e=$("#datagrid").datagrid("getPager");e.pagination({onSelectPage:function(b,c){a.bonus_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.bonus_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.findBonusAmount(a.bonus_data,"bonus/bonusMonthdeatil/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}}),$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.findCodeTypeNames("bonus/bonusMonthdeatil/findCodeTypeNames",function(a,d){$.messager.progress("close");var e=["#dealerType"];c(function(){$("#bonusType").combobox("loadData",b.bonusType),$("#bonusType").combobox("select",b.bonusType[0].code),folUtil.setComboBoxYearDataById("year"),folUtil.setComboBoxMonthDataById("month");for(var c=0;c<a.length;c++)folUtil.isNull(a[c])||($(e[c]).combobox("loadData",a[c]),$(e[c]).combobox("select",a[c][0].code))})},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}),a.findBonusMonthDeatil=function(){var b=folUtil.getComboBoxDataById("year")+"-"+folUtil.convertMonthToTwoPoint(folUtil.getComboBoxDataById("month"));a.bonus_data={dealerType:folUtil.getComboBoxDataById("dealerType"),bonusType:folUtil.getComboBoxDataById("bonusType"),sapCode:$("#sapCode").textbox("getValue"),dealerName:$("#dealerName").textbox("getValue"),changeTime:b,beginNo:0,endNo:10},a.istableshow=!0,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.findBonusMonthDeatil(a.bonus_data,"bonus/bonusMonthdeatil/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},a.monthDeatilResult=function(){d.getToken("services/tokens",function(b,c){return folUtil.isNull(a.bonus_data)?void $.messager.alert("提示","请先查询一次再导出"):($.messager.progress("close"),void e.open("bonus/bonusMonthdeatil/monthDeatilResult?dealerName="+encodeURI(encodeURI(a.bonus_data.dealerName))+"&sapCode="+a.bonus_data.sapCode+"&dealerType="+a.bonus_data.dealerType+"&bonusType="+a.bonus_data.bonusType+"&changeTime="+a.bonus_data.changeTime+"&token="+b.token))},function(a){console.log(a)})},a.findOrderDeatil=function(a){var b=$("#"+a).datagrid("getSelections");return b.length<1?void $.messager.alert("提示","请选择一条记录再操作"):b.length>1?void $.messager.alert("提示","不能选择多条记录，请选择一条记录再操作"):b[0].referType.indexOf("SAP")>-1?void $.messager.alert("提示","该条记录不能查看订单相关信息"):void $.each(b,function(a,b){var c=b.referCode,d=c.split("|");e.open(POL_SERVER_URL+"index.html#/1300_130020?orderNo="+d[0])})},a.findBillingDeatil=function(a){var b=$("#"+a).datagrid("getSelections");return b.length<1?void $.messager.alert("提示","请选择一条记录再操作"):b.length>1?void $.messager.alert("提示","不能选择多条记录，请选择一条记录再操作"):b[0].referType.indexOf("SAP")>-1?void $.messager.alert("提示","该条记录不能查看billing相关信息"):void $.each(b,function(a,b){var c=b.referCode,d=c.split("|");e.open(POL_SERVER_URL+"index.html#/1300_130040?billingNo="+d[1])})}}]),FolController.controller("bonusAmountCollectCtrl",["$scope","$rootScope","$timeout","BonusService","$window",function(a,b,c,d,e){a.istableshow=!1,c(function(){var b=$("#datagrid").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.bonus_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.bonus_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.findBonusAmount(a.bonus_data,"bonus/amountReconcileCollect/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}}),$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.findCodeTypeNames("bonus/amountReconcileCollect/findCodeTypeNames",function(a,b){$.messager.progress("close");var d=["#typeName"];c(function(){folUtil.setComboBoxYearDataById("year"),folUtil.setComboBoxMonthDataById("month");for(var b=0;b<a.length;b++)folUtil.isNull(a[b])||($(d[b]).combobox("loadData",a[b]),$(d[b]).combobox("select",a[b][0].code))})},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}),a.findBonusAmountCollect=function(){var b=folUtil.getComboBoxDataById("year")+"-"+folUtil.convertMonthToTwoPoint(folUtil.getComboBoxDataById("month"));a.bonus_data={typeName:folUtil.getComboBoxDataById("typeName"),changeTime:b,year:folUtil.getComboBoxDataById("year"),month:folUtil.convertMonthToTwoPoint(folUtil.getComboBoxDataById("month")),beginNo:0,endNo:10},a.istableshow=!0,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.findBonusAmountCollect(a.bonus_data,"bonus/amountReconcileCollect/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&$.messager.alert("提示","系统超时请稍后访问")})},a.amountReconcileCollect=function(){d.getToken("services/tokens",function(b,c){return folUtil.isNull(a.bonus_data)?void $.messager.alert("提示","请先查询一次再导出"):void e.open("bonus/amountReconcileCollect/amountReconcileCollect?typeName="+a.bonus_data.typeName+"&changeTime="+a.bonus_data.changeTime+"&year="+a.bonus_data.year+"&month="+a.bonus_data.month+"&token="+b.token)},function(a){console.log(a)})}}]),FolController.controller("BonusDefinitionController",["$scope","$timeout","$state","BonusDefinitionSerivce",function(a,b,c,d){b(function(){var b=$("#datagrid").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.codeVo.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.codeVo.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.queryBonusDefinition(a.codeVo,"bonus/type/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}})}),a.addBonusDefinition=function(){c.go("addBonusDefinition")},a.queryBonusDefinition=function(){a.istableshow=!0,a.codeVo={code:a.code,codeCnDesc:a.codeCnDesc,beginNo:0,endNo:10},$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.queryBonusDefinition(a.codeVo,"bonus/type/query",function(b,c){$.messager.progress("close"),0===b.length?(a.istableshow=!1,$.messager.alert("提示","没有相关符合的数据")):($("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",b))},function(b){$.messager.progress("close"),b.state===STATE.TIMEOUT&&(a.istableshow=!1,$.messager.alert("提示","系统超时请稍后访问"))})},a.updateBonusDefinition=function(){var a=$("#datagrid").datagrid("getSelections");return a.length>1?void $.messager.alert("提示","不能选择多个奖金类型，请重新选择"):a.length<1?void $.messager.alert("提示","请选择一个奖金类型，请重新选择"):void c.go("updateBonusDefinition",{bonusType:a[0]})}}]),FolController.controller("AddBonusDefinitionController",["$scope","$timeout","$state","BonusDefinitionSerivce",function(a,b,c,d){a.addBonusDefinition=function(){var b={code:a.code,codeCnDesc:a.codeCnDesc,remark:a.remark,typeName:"奖金类型"};a.checkData(b)&&d.addBonusDefinition(b,"bonus/type/add",function(a,b){$.messager.alert("提示","新增奖金成功"),c.go("bonusDefinition")},function(a){$.messager.alert("提示","新增奖金失败"),console.log(a)})},a.checkData=function(a){return folUtil.isNull(a.code)?($.messager.alert("提示","请填写奖金代码，再继续操作"),!1):folUtil.isNull(a.codeCnDesc)?($.messager.alert("提示","请填写奖金名称，再继续操作"),!1):!0}}]),FolController.controller("UpdateBonusDefinitionController",["$scope","$timeout","$state","$stateParams","BonusDefinitionSerivce",function(a,b,c,d,e){console.log(d.bonusType),b(function(){$("#code").textbox("setValue",d.bonusType.code),$("#codeCnDesc").textbox("setValue",d.bonusType.codeCnDesc),$("#remark").textbox("setValue",d.bonusType.remark),a.code=d.bonusType.code,a.codeCnDesc=d.bonusType.codeCnDesc,a.remark=d.bonusType.remark,a.codeId=d.bonusType.codeId}),a.updateBonusDefinition=function(){var b={codeId:a.codeId,code:a.code,codeCnDesc:a.codeCnDesc,remark:a.remark};a.checkData(b)&&e.updateBonusDefinition(b,"bonus/type/update",function(a,b){$.messager.alert("提示","更新奖金成功"),c.go("bonusDefinition")},function(a){$.messager.alert("提示","更新奖金失败"),console.log(a)})},a.checkData=function(a){return folUtil.isNull(a.code)?($.messager.alert("提示","请填写奖金代码，再继续操作"),!1):folUtil.isNull(a.codeCnDesc)?($.messager.alert("提示","请填写奖金名称，再继续操作"),!1):!0}}]),FolController.controller("BonusIssueController",["$scope","$timeout","$q","$window","BonusIssueService",function(a,b,c,d,e){a.istableshow=!1,b(function(){if($("#datagrid").length>0){var b=$("#datagrid").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.query_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.query_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.query_data,"bonus/bonusissue/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}})}}),a.query=function(){a.istableshow=!0,a.query_data={batchNo:a.batchNo,matchState:STATE.SUCCESS_AUDIT,issueStatus:STATE.WAIT_ISSUE,type:TYPE.BONUS_ISSUE,beginNo:0,endNo:10},$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.query_data,"bonus/bonusissue/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},a.bonusIssue=function(){var b=$("#datagrid").datagrid("getSelections");if(b.length<1)return void $.messager.alert("提示","请选择一个文件在发放");if(b.length>1)return void $.messager.alert("提示","不能选择多个文件在发放");var d=c.defer(),f=d.promise;$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.issue(b[0],"bonus/bonusissue/payBonus",function(a,b){$.messager.progress("close"),d.resolve("success")},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT?d.resolve("timeout"):d.reject("fail")}),f.then(function(b){"success"===b?$.messager.alert("提示","奖金发放成功"):(b="timeout")&&$.messager.alert("提示","奖金发放操作正在进行中，由于执行时间长请稍后查询结果"),e.query(a.query_data,"bonus/bonusissue/query",function(a,b){$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},function(b){$.messager.alert("提示","奖金发放失败"),e.query(a.query_data,"bonus/bonusissue/query",function(a,b){$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})})},a.back=function(){var b=c.defer(),d=b.promise,f=$("#datagrid").datagrid("getSelections");return f.length<1?void $.messager.alert("提示","请选择一个文件在发放"):f.length>1?void $.messager.alert("提示","不能选择多个文件在发放"):(e.issue(f,"bonus/bonusissue/bonusReject",function(a,c){b.resolve("success")},function(a,c){b.reject("fail")}),void d.then(function(){$.messager.alert("提示","奖金回退成功"),e.query(a.query_data,"bonus/bonusissue/query",function(a,b){$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},function(){$.messager.alert("提示","奖金回退失败")}))},a.exportFile=function(){var a=$("#datagrid").datagrid("getSelections");return a.length<1?void $.messager.alert("提示","请选择一个奖金记录再进行操作"):a.length>1?void $.messager.alert("提示","不能选择多个奖金记录进行操作"):void e.getToken("services/tokens",function(b){$.messager.progress("close"),d.open("bonus/bonusissue/exportFile?issueState="+STATE.WAIT_ISSUE+"&batchNo="+a[0].batchNo+"&token="+b.token)},function(a){console.log(a)})}}]),FolController.controller("BonusIssueSuccessController",["$scope","$timeout","$q","$window","BonusIssueService",function(a,b,c,d,e){b(function(){if($("#bonusIssueGridDate").length>0){var b=$("#bonusIssueGridDate").datagrid("getPager");b.pagination({onSelectPage:function(b,c){a.bonus_Issue_Query_Condition.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.bonus_Issue_Query_Condition.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.bonus_Issue_Query_Condition,"bonus/bonusissue/queryBonusIssueSuc",function(a,b){$.messager.progress("close"),$("#bonusIssueGridDate").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}})}}),a.bonusIssueQuery=function(){a.istableshow=!0,a.bonus_Issue_Query_Condition={batchNo:$("#bonusIssueBatchNo").textbox("getValue"),beginDate:$("#bonusIssueBeginDate").datebox("getValue"),endDate:$("#bonusIssueEndDate").datebox("getValue"),beginNo:0,endNo:10},$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.bonusIssueQuery(a.bonus_Issue_Query_Condition,"bonus/bonusissue/queryBonusIssueSuc",function(a,b){$.messager.progress("close"),$("#bonusIssueGridDate").datagrid("loadData",{total:0,rows:[]}),$("#bonusIssueGridDate").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},a.exportFile=function(){var a=$("#bonusIssueGridDate").datagrid("getSelections");return a.length<1?void $.messager.alert("提示","请选择一个奖金记录再进行操作"):a.length>1?void $.messager.alert("提示","不能选择多个奖金记录进行操作"):void e.getToken("services/tokens",function(b){$.messager.progress("close"),d.open("bonus/bonusissue/exportFile?issueState="+STATE.SUCCESS_ISSUE+"&batchNo="+a[0].batchNo+"&token="+b.token)},function(a){console.log(a)})}}]),FolController.controller("BonusIssueVersionFileAuditController",["$scope","$timeout","$q","$window","BonusIssueVersionFileAuditService","CodeService",function(a,b,c,d,e,f){a.istableshow=!1,b(function(){var c=$("#datagrid").datagrid("getPager");c.pagination({onSelectPage:function(b,c){a.query_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.query_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.query_data,"bonus/bonusissue/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}}),$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT});var d=["渠道类型","奖金类型"];f.findCodeTypeNames(d,"code/findCodeTypeNames",function(a){$.messager.progress("close");var c=["#dealerType","#bonusType"];b(function(){for(var b=0;b<a.length;b++)folUtil.isNull(a[b])||($(c[b]).combobox("loadData",a[b]),$(c[b]).combobox("select",a[b][0].code))})},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}),a.query=function(){a.istableshow=!0,a.query_data={dealerType:folUtil.getComboBoxDataById("dealerType"),bonusType:folUtil.getComboBoxDataById("bonusType"),beginDate:$("#startTime").datebox("getValue"),endDate:$("#endTime").datebox("getValue"),batchNo:a.batchNo,matchState:STATE.REAST_AUDIT,type:TYPE.BONUS_AUDIT,beginNo:0,endNo:10},$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),e.query(a.query_data,"bonus/bonusissue/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},a.audit=function(){var b=c.defer(),d=b.promise,f=$("#datagrid").datagrid("getSelections");return f.length<1?void $.messager.alert("提示","请选择一条记录再进行操作"):(e.audit(f,"bonus/bonusissue/bonusAudit",function(a){b.resolve("success")},function(a){b.reject("fail")}),void d.then(function(){$.messager.alert("提示","奖金发放文件审核成功"),e.query(a.query_data,"bonus/bonusissue/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},function(){$.messager.alert("提示","奖金发放文件审核失败")}))},a.reject=function(){var b=c.defer(),d=b.promise,f=$("#datagrid").datagrid("getSelections");return f.length<1?void $.messager.alert("提示","请选择一条记录再进行操作"):(e.reject(f,"bonus/bonusissue/bonusReject",function(a,c){b.resolve("success")},function(a){b.reject("fail")}),void d.then(function(){$.messager.alert("提示","奖金发放文件驳回成功"),e.query(a.query_data,"bonus/bonusissue/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},function(){$.messager.alert("提示","奖金发放文件驳回失败")}))},a.exportFile=function(){var a=$("#datagrid").datagrid("getSelections");return a.length<1?void $.messager.alert("提示","请选择一个奖金记录再进行操作"):a.length>1?void $.messager.alert("提示","不能选择多个奖金记录进行操作"):void e.getToken("services/tokens",function(b){$.messager.progress("close"),d.open("bonus/bonusissue/exportFile?issueState="+STATE.FAIL_ISSUE+"&batchNo="+a[0].batchNo+"&token="+b.token)},function(a){console.log(a)})}}]),FolController.controller("BonusIssueVersionUploadController",["$rootScope","$scope","$state","$timeout","$q","$window","BonusIssueVersionUploadService","CodeService",function(a,b,c,d,e,f,g,h){b.istableshow=!1,d(function(){var a=$("#datagrid").datagrid("getPager");a.pagination({onSelectPage:function(a,c){b.query_data.beginNo=c*(a-1)==0?0:c*(a-1)+1,b.query_data.endNo=c*a,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),g.issueVersionQuery(b.query_data,"bonus/bonusissue/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}}),$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT});var c=["渠道类型","奖金类型"];h.findCodeTypeNames(c,"code/findCodeTypeNames",function(a){$.messager.progress("close");var b=["#dealerType","#bonusType"];d(function(){for(var c=0;c<a.length;c++)folUtil.isNull(a[c])||($(b[c]).combobox("loadData",a[c]),$(b[c]).combobox("select",a[c][0].code))})},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}),b.issueVersionQuery=function(){b.istableshow=!0,b.query_data={dealerType:folUtil.getComboBoxDataById("dealerType"),bonusType:folUtil.getComboBoxDataById("bonusType"),beginDate:$("#startTime").datebox("getValue"),endDate:$("#endTime").datebox("getValue"),batchNo:b.batchNo,matchState:STATE.WAIT_AUDIT,type:TYPE.BONUS_UPLOAD,beginNo:0,endNo:10},$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),g.issueVersionQuery(b.query_data,"bonus/bonusissue/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},b.issueVersionReUpload=function(){var a=$("#datagrid").datagrid("getSelections");if(a.length>1)$.messager.alert("提示","不能选择多条记录重新上传");else if(a.length<1)$.messager.alert("提示","请选择一条记录重新上传");else{var b=new Array;$.each(a[0],function(a,c){folUtil.isNull(c)||folUtil.isNull(c.publishDate)||(c.publishDate=null),b.push(c)}),c.go("uploadFilePage",{pageName:"bonusIssueVersion",data:b})}},b.cancel=function(){var a=$("#datagrid").datagrid("getSelections");if(a.length<1)$.messager.alert("提示","请选择一条记录再进行作废操作");else{var c=e.defer(),d=c.promise;g.cancel(a,"bonus/bonusissue/cancalBonusFile",function(a,b){c.resolve("success")},function(a,b){c.resvole("reject")}),d.then(function(){$.messager.alert("提示","发放文件作废成功"),$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),g.issueVersionQuery(b.query_data,"bonus/bonusissue/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},function(){$.messager.alert("提示","发放文件作废失败")})}},b.confirmAudit=function(){var a=$("#datagrid").datagrid("getSelections");if(a.length<1)$.messager.alert("提示","请选择一条记录再进行作废操作");else{var c=e.defer(),d=c.promise;g.confirmAudit(a,"bonus/bonusissue/confirmAudit",function(a,b){c.resolve("success")},function(a){c.resvole("reject")}),d.then(function(){$.messager.alert("提示","发放文件已确认需要审核"),$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),g.issueVersionQuery(b.query_data,"bonus/bonusissue/query",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},function(){$.messager.alert("提示","发放文件确认需要审核失败")})}},b.downloadTemp=function(){$.messager.progress({title:"Please waiting",msg:"downloading template...",interval:PROGRESS_ACTION_TIMEOUT}),g.getToken("services/tokens",function(a){$.messager.progress("close");var b="bonus/bonusissue/downloadTemp?token="+a.token;console.log(b),f.open(b)},function(a){$.messager.progress("close"),console.log(a)})},b.uploadBonusIssueVersion=function(){c.go("uploadFilePage",{pageName:"bonusIssueVersion"})},b.exportFile=function(){var a=$("#datagrid").datagrid("getSelections");return a.length<1?void $.messager.alert("提示","请选择一个奖金记录再进行操作"):a.length>1?void $.messager.alert("提示","不能选择多个奖金记录进行操作"):void g.getToken("services/tokens",function(b){$.messager.progress("close"),f.open("bonus/bonusissue/exportFile?issueState="+STATE.WAIT_ISSUE+"&batchNo="+a[0].batchNo+"&token="+b.token)},function(a){console.log(a)})}}]),FolController.controller("BonusReastDisposeController",["$scope","$timeout","$q","BonusReastDisposeService","CodeService",function(a,b,c,d,e){a.istableshow=!1,b(function(){var c=$("#datagrid").datagrid("getPager");c.pagination({onSelectPage:function(b,c){a.query_data.beginNo=c*(b-1)==0?0:c*(b-1)+1,a.query_data.endNo=c*b,$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.query(a.query_data,"bonus/bonusissue/queryBonusIssueFail",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}}),$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT});var f=["奖金类型","销售公司类型"];e.findCodeTypeNames(f,"code/findCodeTypeNames",function(a){$.messager.progress("close");var c=["#bonusType","#serv"];b(function(){for(var b=0;b<a.length;b++)folUtil.isNull(a[b])||($(c[b]).combobox("loadData",a[b]),$(c[b]).combobox("select",a[b][0].code))})},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}),a.query=function(){a.istableshow=!0,a.query_data={bonusType:folUtil.getComboBoxDataById("bonusType"),serv:folUtil.getComboBoxDataById("serv"),batchNo:a.batchNo,sapCode:a.sapCode,beginDate:$("#startTime").datebox("getValue"),endDate:$("#endTime").datebox("getValue"),issueStatus:STATE.FAIL_ISSUE,type:TYPE.BONUS_ISSUE,beginNo:0,endNo:10},$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.query(a.query_data,"bonus/bonusissue/queryBonusIssueFail",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},a.reastDispose=function(){var b=c.defer(),e=b.promise,f=$("#datagrid").datagrid("getSelections");return f.length<1?void $.messager.alert("提示","请选择相应的记录再操作"):(d.reastDispose(f,"bonus/bonusissue/payAgainBonus",function(a,c){b.resolve("success")},function(a){b.reject("fail")}),void e.then(function(b){$.messager.alert("提示","奖金重处理成功"),$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.query(a.query_data,"bonus/bonusissue/queryBonusIssueFail",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},function(b){$.messager.alert("提示","奖金重处理失败"),$.messager.progress({title:"Please waiting",msg:"Loading data...",interval:PROGRESS_ACTION_TIMEOUT}),d.query(a.query_data,"bonus/bonusissue/queryBonusIssueFail",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})}))},a.back=function(){var b=c.defer(),e=b.promise,f=$("#datagrid").datagrid("getSelections");return f.length<1?void $.messager.alert("提示","请选择一条记录再进行操作"):(d.reject(f,"bonus/bonusissue/bonusReject",function(a,c){b.resolve("success")},function(a){b.reject("fail")}),void e.then(function(){$.messager.alert("提示","奖金发放文件驳回成功"),d.query(a.query_data,"bonus/bonusissue/queryBonusIssueFail",function(a,b){$.messager.progress("close"),$("#datagrid").datagrid("loadData",{total:0,rows:[]}),$("#datagrid").datagrid("loadData",a)},function(a){$.messager.progress("close"),a.state===STATE.TIMEOUT&&(console.log("timeout"),$.messager.alert("提示","系统超时请稍后访问"))})},function(){$.messager.alert("提示","奖金发放文件驳回失败")}))},a.exportFile=function(){var a=$("#datagrid").datagrid("getSelections");return a.length<1?void $.messager.alert("提示","请选择一个奖金记录再进行操作"):a.length>1?void $.messager.alert("提示","不能选择多个奖金记录进行操作"):void d.getToken("services/tokens",function(b){$.messager.progress("close"),$window.open("bonus/bonusissue/exportFile?issueState="+STATE.FAIL_ISSUE+"&batchNo="+a[0].batchNo+"&token="+b.token)},function(a){console.log(a)})}}]);